// ==UserScript==
// @name         æ‚¬æµ®å…ƒç´ æ§åˆ¶å™¨
// @namespace    https://github.com/qinhua/tampermonkey-userscripts/tree/main/disable-floater
// @version      1.1
// @description  æ‰‹åŠ¨æ§åˆ¶æµè§ˆå™¨æ’ä»¶çš„æ‚¬æµ®å…ƒç´ ï¼Œé¿å…å½±å“ç½‘é¡µæµè§ˆ
// @author       Marek Qin
// @match        *://*/*
// @icon         https://raw.githubusercontent.com/qinhua/tampermonkey-userscripts/refs/heads/main/disable-floater/logo.png
// @grant        GM_addStyle
// @grant        unsafeWindow
// @noframes
// @license      MIT
// @downloadURL https://raw.githubusercontent.com/qinhua/tampermonkey-userscripts/refs/heads/main/disable-floater/index.js
// @updateURL https://raw.githubusercontent.com/qinhua/tampermonkey-userscripts/refs/heads/main/disable-floater/index.js
// ==/UserScript==

function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,i,s=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=a.call(n)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){u=!0,r=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(){"use strict";if(window.self===window.top&&!document.getElementById("disable-floater-container")){var e=function(){return _createClass(function e(t){_classCallCheck(this,e),this.container=t,this.hideSelectors=["icbu-ai-csui","doubao-ai-csui","floating-lens-root","alibaba-lens-root","#market-mate-for-1688"],this.hiddenElements=new Map,this.imageOriginalStyles=new Map,this.eventInterceptors=new Map,this.imageMouseoverRemoved=!1,this.imageObserver=null,this.mouseEvents=["mouseover","mouseenter","mouseleave","mousemove","mouseout","pointerover","pointerenter","pointerleave","pointermove","pointerout"],this.init()},[{key:"init",value:function(){this._initialized||(this._initialized=!0,this.createTrustedPolicy(),this.render(),this.bindEvents(),console.log("DisableFloater æ‚¬æµ®å…ƒç´ æ§åˆ¶å™¨-å·²åŠ è½½ âœ…"))}},{key:"createTrustedPolicy",value:function(){if(window.trustedTypes&&window.trustedTypes.createPolicy)try{window.trustedTypes.createPolicy("default",{createHTML:function(e,t){return e}})}catch(e){console.warn("æ— æ³•åˆ›å»ºTrusted Typesç­–ç•¥:",e)}}},{key:"render",value:function(){this.injectStyles(),this.container.innerHTML='\n        <button class="disable-floater-btn" id="btn-hide" title="éšè—æ‚¬æµ®å…ƒç´ ">ğŸš«</button>\n        <button class="disable-floater-btn" id="btn-temp-hide" title="ä¸´æ—¶éšè—5ç§’">â±ï¸</button>\n        <button class="disable-floater-btn" id="btn-show" title="æ˜¾ç¤ºæ‚¬æµ®å…ƒç´ ">ğŸ‘ï¸</button>\n        <button class="disable-floater-btn" id="btn-toggle-mouseover" title="ç§»é™¤å›¾ç‰‡æ‚¬æµ®äº‹ä»¶">ğŸŒ </button>\n      '}},{key:"injectStyles",value:function(){var e="\n        #disable-floater-container {\n          position: fixed;\n          right: 2px;\n          bottom: 2px;\n          padding: 4px;\n          z-index: 999999;\n          display: flex;\n          flex-direction: row;\n          justify-content: center;\n          align-items: center;\n          gap: 4px;\n          background: #2c3e50;\n          border-radius: 6px;\n          box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n          transition: all 0.3s ease;\n          font-family: Arial, sans-serif;\n        }\n        #disable-floater-container:hover {\n          right: 5px;\n        }\n        .disable-floater-btn {\n          display: block;\n          cursor: pointer;\n          width: 24px;\n          height: 24px;\n          color: white;\n          font-size: 12px;\n          border: none;\n          border-radius: 4px;\n          background: #34495e;\n          transition: all 0.2s ease;\n        }\n        .disable-floater-btn:hover {\n          background: #1abc9c;\n          transform: scale(1.1);\n        }\n        .disable-floater-btn:active {\n          transform: scale(0.9);\n        }\n        .disable-floater-feedback {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          background: #27ae60;\n          color: white;\n          padding: 12px 20px;\n          border-radius: 8px;\n          z-index: 999999;\n          font-size: 14px;\n          font-weight: bold;\n          box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n          animation: disableFloaterFadeInOut 2s ease-in-out;\n          font-family: Arial, sans-serif;\n        }\n        @keyframes disableFloaterFadeInOut {\n          0% { opacity: 0; transform: translateY(-20px); }\n          20% { opacity: 1; transform: translateY(0); }\n          80% { opacity: 1; transform: translateY(0); }\n          100% { opacity: 0; transform: translateY(-20px); }\n        }\n        @keyframes disableFloaterFadeOut {\n          to { opacity: 0; }\n        }\n      ";if("undefined"!=typeof GM_addStyle)GM_addStyle(e);else{var t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}}},{key:"bindEvents",value:function(){var e=this,t=this.container.querySelector("#btn-hide"),n=this.container.querySelector("#btn-temp-hide"),o=this.container.querySelector("#btn-show"),r=this.container.querySelector("#btn-toggle-mouseover");t&&t.addEventListener("click",function(){return e.hideAllFloaters()}),n&&n.addEventListener("click",function(){return e.tempHideFloaters()}),o&&o.addEventListener("click",function(){return e.showAllFloaters()}),r&&r.addEventListener("click",function(){return e.toggleImageMouseover(function(){r.textContent=e.imageMouseoverRemoved?"ğŸŒŒ":"ğŸŒ ",r.title=e.imageMouseoverRemoved?"æ¢å¤å›¾ç‰‡æ‚¬æµ®äº‹ä»¶":"ç§»é™¤å›¾ç‰‡æ‚¬æµ®äº‹ä»¶"})})}},{key:"findElements",value:function(e){try{var t=[];if(e.startsWith("#")){var n=document.getElementById(e.substring(1));n&&t.push(n)}else if(e.startsWith(".")){var o=document.getElementsByClassName(e.substring(1));t.push.apply(t,_toConsumableArray(Array.from(o)))}else if(e.startsWith("[")&&e.endsWith("]")){var r=document.querySelectorAll(e);t.push.apply(t,_toConsumableArray(Array.from(r)))}else try{var a=document.querySelectorAll(e);t.push.apply(t,_toConsumableArray(Array.from(a)))}catch(n){var i=document.getElementsByTagName(e);t.push.apply(t,_toConsumableArray(Array.from(i)))}return t}catch(t){return console.warn("æŸ¥æ‰¾å…ƒç´ æ—¶å‡ºé”™ (é€‰æ‹©å™¨: ".concat(e,"):"),t),[]}}},{key:"clearImageEventHandlers",value:function(e){e.onmouseover=null,e.onmouseenter=null,e.onmouseleave=null,e.onmousemove=null,e.onmouseout=null,e.onpointerover=null,e.onpointerenter=null,e.onpointerleave=null,e.onpointermove=null,e.onpointerout=null}},{key:"removeAllImageMouseover",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var n=document.querySelectorAll("img"),o=0;n.forEach(function(t){if(!e.imageOriginalStyles.has(t)){var n={onmouseover:t.onmouseover,onmouseenter:t.onmouseenter,onmouseleave:t.onmouseleave,onmousemove:t.onmousemove,pointerEvents:t.style.pointerEvents,style:t.getAttribute("style"),eventListeners:[]};e.imageOriginalStyles.set(t,n)}t.style.pointerEvents="none",e.clearImageEventHandlers(t);var r=function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()};e.mouseEvents.forEach(function(e){t.addEventListener(e,r,!0)}),e.eventInterceptors.set(t,{stopEvent:r,mouseEvents:e.mouseEvents}),t.dataset.mouseoverRemoved="true",o++}),this.startImageObserver(),this.imageMouseoverRemoved=!0,t&&this.showFeedback("ğŸŒ  å·²ç§»é™¤ ".concat(o," ä¸ªå›¾ç‰‡çš„æ‚¬æµ®äº‹ä»¶"))}catch(e){console.error("ç§»é™¤å›¾ç‰‡æ‚¬æµ®äº‹ä»¶æ—¶å‡ºé”™:",e),t&&this.showFeedback("âš ï¸ ç§»é™¤å›¾ç‰‡æ‚¬æµ®äº‹ä»¶æ—¶å‡ºç°é”™è¯¯: ".concat(e.message||"æœªçŸ¥é”™è¯¯"))}}},{key:"startImageObserver",value:function(){var e=this;this.imageObserver||(this.imageObserver=new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.forEach(function(t){t.nodeType===Node.ELEMENT_NODE&&("IMG"!==t.tagName||t.dataset.mouseoverRemoved||e.processNewImage(t),(t.querySelectorAll?t.querySelectorAll("img:not([data-mouseover-removed])"):[]).forEach(function(t){return e.processNewImage(t)}))})})}),this.imageObserver.observe(document.body,{childList:!0,subtree:!0}))}},{key:"processNewImage",value:function(e){if(e&&!e.dataset.mouseoverRemoved){this.imageOriginalStyles.has(e)||this.imageOriginalStyles.set(e,{onmouseover:e.onmouseover,onmouseenter:e.onmouseenter,onmouseleave:e.onmouseleave,onmousemove:e.onmousemove,pointerEvents:e.style.pointerEvents,style:e.getAttribute("style")}),e.style.pointerEvents="none",this.clearImageEventHandlers(e);var t=function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()};this.mouseEvents.forEach(function(n){e.addEventListener(n,t,!0)}),this.eventInterceptors.set(e,{stopEvent:t,mouseEvents:this.mouseEvents}),e.dataset.mouseoverRemoved="true"}}},{key:"stopImageObserver",value:function(){this.imageObserver&&(this.imageObserver.disconnect(),this.imageObserver=null)}},{key:"restoreAllImageMouseover",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{this.stopImageObserver();var n,o=0,r=_createForOfIteratorHelper(this.imageOriginalStyles);try{var a=function(){var t=_slicedToArray(n.value,2),r=t[0],a=t[1];if(r&&r.nodeType===Node.ELEMENT_NODE){var i=e.eventInterceptors.get(r);if(i&&(i.mouseEvents.forEach(function(e){r.removeEventListener(e,i.stopEvent,!0)}),e.eventInterceptors.delete(r)),r.onmouseover=a.onmouseover||null,r.onmouseenter=a.onmouseenter||null,r.onmouseleave=a.onmouseleave||null,r.onmousemove=a.onmousemove||null,a.pointerEvents?r.style.pointerEvents=a.pointerEvents:r.style.removeProperty("pointer-events"),a.style){var s=a.style;r.setAttribute("style",s)}delete r.dataset.mouseoverRemoved,o++}};for(r.s();!(n=r.n()).done;)a()}catch(e){r.e(e)}finally{r.f()}this.imageOriginalStyles.clear(),this.eventInterceptors.clear(),document.querySelectorAll("img[data-mouseover-removed]").forEach(function(t){var n=e.eventInterceptors.get(t);n&&n.mouseEvents.forEach(function(e){t.removeEventListener(e,n.stopEvent,!0)}),t.style.removeProperty("pointer-events"),delete t.dataset.mouseoverRemoved,o++}),this.imageMouseoverRemoved=!1,t&&this.showFeedback("ğŸŒŒ å·²æ¢å¤ ".concat(o," ä¸ªå›¾ç‰‡çš„æ‚¬æµ®äº‹ä»¶"))}catch(e){console.error("æ¢å¤å›¾ç‰‡æ‚¬æµ®äº‹ä»¶æ—¶å‡ºé”™:",e),t&&this.showFeedback("âš ï¸ æ¢å¤å›¾ç‰‡æ‚¬æµ®äº‹ä»¶æ—¶å‡ºç°é”™è¯¯: ".concat(e.message||"æœªçŸ¥é”™è¯¯"))}}},{key:"toggleImageMouseover",value:function(e){this.imageMouseoverRemoved?this.restoreAllImageMouseover():this.removeAllImageMouseover(),e&&e()}},{key:"hideAllFloaters",value:function(){var e=this,t=0;try{this.hideSelectors.forEach(function(n){e.findElements(n).forEach(function(n){if(n&&n.nodeType===Node.ELEMENT_NODE){n.dataset.originalDisplay||(n.dataset.originalDisplay=n.style.display||"",n.dataset.originalVisibility=n.style.visibility||""),n.style.cssText+="; display: none !important; visibility: hidden !important;";var o=e.getElementKey(n);e.hiddenElements.set(o,n),t++}})}),this.showFeedback("ğŸ¯ å·²éšè— ".concat(t," ä¸ªæ‚¬æµ®å…ƒç´ "))}catch(e){console.error("éšè—å…ƒç´ æ—¶å‡ºé”™:",e),this.showFeedback("âš ï¸ éšè—å…ƒç´ æ—¶å‡ºç°é”™è¯¯: ".concat(e.message||"æœªçŸ¥é”™è¯¯"))}}},{key:"showAllFloaters",value:function(){var e=0;try{var t,n=_createForOfIteratorHelper(this.hiddenElements);try{for(n.s();!(t=n.n()).done;){var o=_slicedToArray(t.value,2),r=(o[0],o[1]);r&&r.nodeType===Node.ELEMENT_NODE&&(r.style.display=r.dataset.originalDisplay||"",r.style.visibility=r.dataset.originalVisibility||"",delete r.dataset.originalDisplay,delete r.dataset.originalVisibility,e++)}}catch(e){n.e(e)}finally{n.f()}this.hiddenElements.clear(),document.querySelectorAll("*[data-original-display], *[data-original-visibility]").forEach(function(t){t.nodeType===Node.ELEMENT_NODE&&(t.style.display=t.dataset.originalDisplay||"",t.style.visibility=t.dataset.originalVisibility||"",delete t.dataset.originalDisplay,delete t.dataset.originalVisibility,e++)}),this.showFeedback("ğŸ‘ï¸ å·²æ¢å¤ ".concat(e," ä¸ªæ‚¬æµ®å…ƒç´ "))}catch(e){console.error("æ˜¾ç¤ºå…ƒç´ æ—¶å‡ºé”™:",e),this.showFeedback("âš ï¸ æ˜¾ç¤ºå…ƒç´ æ—¶å‡ºç°é”™è¯¯: ".concat(e.message||"æœªçŸ¥é”™è¯¯"))}}},{key:"tempHideFloaters",value:function(){try{this.hideAllFloaters(),this.showFeedback("â±ï¸ å·²éšè—æ‚¬æµ®å…ƒç´ ï¼Œ5ç§’åæ¢å¤")}catch(e){console.error("ä¸´æ—¶éšè—å…ƒç´ æ—¶å‡ºé”™:",e),this.showFeedback("âš ï¸ ä¸´æ—¶éšè—å…ƒç´ æ—¶å‡ºç°é”™è¯¯: ".concat(e.message||"æœªçŸ¥é”™è¯¯"))}}},{key:"getElementKey",value:function(e){if(e.id)return"id:".concat(e.id);if(e.tagName){var t=e.className?e.className:"",n=e.dataset.id?e.dataset.id:"";return"tag:".concat(e.tagName,"-class:").concat(t,"-dataid:").concat(n)}return"element:".concat(Date.now(),":").concat(Math.random())}},{key:"showFeedback",value:function(e){try{var t=document.getElementById("disable-floater-feedback");t&&t.remove();var n=document.createElement("div");n.id="disable-floater-feedback",n.className="disable-floater-feedback",n.textContent=e,document.body.appendChild(n),setTimeout(function(){n&&n.style&&(n.style.animation="disableFloaterFadeOut 0.5s ease-in-out",setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n)},500))},1500)}catch(e){console.error("æ˜¾ç¤ºåé¦ˆä¿¡æ¯æ—¶å‡ºé”™:",e)}}}])}();window.__disableFloaterInitialized||("loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):setTimeout(t,0))}function t(){try{if(window.__disableFloaterInitialized||document.getElementById("disable-floater-container"))return;window.__disableFloaterInitialized=!0;var n=document.createElement("div");if(n.id="disable-floater-container",new e(n),document.body)document.body.appendChild(n);else{if(!document.documentElement)return window.__disableFloaterInitialized=!1,void setTimeout(t,100);document.documentElement.appendChild(n)}}catch(e){console.error("åˆå§‹åŒ– DisableFloater æ—¶å‡ºé”™:",e),window.__disableFloaterInitialized=!1,setTimeout(function(){try{t()}catch(e){console.error("é‡è¯•åˆå§‹åŒ–æ—¶å‡ºé”™:",e)}},500)}}}();